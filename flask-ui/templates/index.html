<!--user functionality page-->

{% extends "base.html" %}

{% block content %}
    <!--header-->
    <h4>Current user: {{ user }}</h4>
    <h1>L-NAS</h1>
    

    <!--file upload-->
    <h2>Upload a File</h2>
    <form method="post" action="{{ url_for('upload_file') }}" enctype="multipart/form-data">
        <input type="file" name="file" required>
        <input type="hidden" name="current_path" value="{{ subpath }}"> <!-- make sure name matches name in upload_file in ui.py!-->
        <button type="submit">Upload</button>
    </form>


    <!--create new folder-->
    <h2>Create a New Folder</h2>
    <form action="{{ url_for('create_folder') }}" method="POST">
        <input type="text" name="folder_name" placeholder="Enter folder name" required>
        <input type="hidden" name="current_path" value="{{ subpath }}"> <!-- make sure name matches name in create_folder in ui.py!-->
        <button type="submit">Create Folder</button>
    </form>

    
    <!-- Current folder display -->
    <h2>Current folder: {{ subpath or FILE_FOLDER }}</h2>

    <!--show parent folder if not in root (my_files)-->
    {% if parent_path is not none %}
    <p>
        <a href="{{ url_for('index', path=parent_path) }}">‚¨Ü Go to parent folder</a>
    </p>
    {% endif %}


    <!--show contents of current folder-->
    <h3>Contents:</h3>
    
    <h4>Folders</h4>
    <ul>
    {% for folder in folders %}
        <li>
            üìÅ <a href="{{ url_for('index', path=(subpath ~ '/' if subpath else '') ~ folder) }}">
                {{ folder }}
            </a>
            
         <!--edit button-->
        <button type="button" onclick="toggleRename('folder-{{ loop.index }}')">Edit</button>
        
        <!--hidden rename form-->
        <form id="folder-{{ loop.index }}" action="{{ url_for('rename_item') }}" method="POST" style="display:none; margin-top:5px;">
            <input type="hidden" name="current_path" value="{{ subpath }}">
            <input type="hidden" name="old_name" value="{{ folder }}">
            <input type="text" name="new_name" placeholder="New name" required>
            <button type="submit">Rename</button>
        </form>

        </li>
    {% endfor %}
    </ul>

    <h4>Files</h4>
    <ul>
    {% for file in files %}
        <li>
            üìÑ {{ file }}
            [<a href="{{ url_for('download_file') }}?filename={{ file }}&path={{ subpath }}">Download</a>]
            
        <!--edit button-->
        <button type="button" onclick="toggleRename('file-{{ loop.index }}')">Edit</button>
        
        <!--hidden rename form-->
        <form id="file-{{ loop.index }}" action="{{ url_for('rename_item') }}" method="POST" style="display:none; margin-top:5px;">
            <input type="hidden" name="current_path" value="{{ subpath }}">
            <input type="hidden" name="old_name" value="{{ file }}">
            <input type="text" name="new_name" placeholder="New name" required>
            <button type="submit">Rename</button>
        </form>

        </li>
    {% endfor %}
    </ul>

    <!--rename fuction-->
    <script>
    function toggleRename(id) {
        const form = document.getElementById(id);
        if (!form) return;
        if (form.style.display === "none") {
            form.style.display = "inline-block";
        } else {
            form.style.display = "none";
        }
    }
    </script>

{% endblock %}
